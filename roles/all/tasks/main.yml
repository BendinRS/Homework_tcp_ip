---
# tasks file for all


  - name: install tcpdump && nano
    yum:
      state: present
      name:
        - tcpdump
        - nano
    when: (ansible_hostname == "all")

  - name: install iptables
    yum:
      state: present
      name:
        - iptables
        - iptables-services
    when: (ansible_hostname == "inetRouter")
    

  - name: copy iptables config
    template:
      src: ./files/iptables
      dest: /etc/sysconfig/iptables
    when: (ansible_hostname == "inetRouter")
 
  - name: start and enable iptables service
    service:
      name: iptables
      state: restarted
      enabled: true
    when: (ansible_hostname == "inetRouter")
 
  # - name: restart  iptables service
  #   shell: systemctl restart iptables
  #   when: (ansible_hostname == "inetRouter")

  # - name: start and enable iptables service
  #   service:
  #     name: iptables
  #     state: restarted
  #   when: (ansible_hostname == "inetRouter")

  - name: set up forward packages across routers
    sysctl:
      name: net.ipv4.conf.all.forwarding
      value: '1'
      state: present
    when: "'routers' in group_names"

